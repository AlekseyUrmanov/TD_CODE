import math
import sqlite3
import matplotlib.pyplot as plt

consumer_key = 'Y1KS0BMRKRBSI6CVNYIHHN1NVF3VUI2J'

access_token = "Bearer y0fbcMLWPmZ/3JCQC6tLhiyvFqWusv5aMRnH6DsHLnGy0xTYx+djg2IxpmO8sJwF4soent/i1iVuIOVMsB5/dJGkKhacyGO1oGFMQ+lIKhRGB1M/6kqCFjc68hgiOLTS4/V2Gvq+Yr9z6Ze++5VymK8gzGzB7XuEbbJrh2AE6RxE8e1eO/BoY4lAIxVEAVQSpAQcx1HzC231OlwcTC7rxQI2cfiD1uPQWrPTIbfUP/b6d6TbBo0qk+7VrOj4CemZ87wLoLmszXIH/zFV0eYLR5MOlK43x22TQXkCjWWvUh/ON9o1IinO86yRDcaYryab6uyWFkSAKKekPstZDsT7Hw1TEUTBv55RDoE9YdfwFU2RBN7JNAQ4AMr54JPAyU0+ZHcJQ8h3caI4qhUk7mddyiOXpKzoL68axfCTx5mc2cvaz3QzhFrYWyo3sep872arL50rT9XcaTtnB/rZMx2TM52nEXc4XHoNJI6Df00rPcmHShul9HtsHAMj2zzef7jpKF4u11HGJEDUqjW8SO4KCxWw+zy3nGLURZFTy93bVXKkwHgaE100MQuG4LYrgoVi/JHHvl+pNCjt36YXoLK2sAS2xrp1LlwN4nGJ4PIe9Wb6B7Fvj4MNsFEQKIN3vNgMUHC9jMXmjJlye6H7zeYEG5liIYhPHxCnqVrqzTWlQzE96dNvR61fSrAjsQRKzaACuE/8ib6N1gKIR/37AkhSKghJzVpeLTZZKQ/Rhefjp7a6Ps17w7WCm8QDJlgtdwmAMasLM1n1mQVhb/k1V9jU2AjINMHktqUIPbq5QJlcwgwIhjbQIM+VMc8R87+4kuv/Zk4S/ZwOdVlLbgMUCsmXT6QNGx3Z1GsTG2jT0cqECziFQPnl0wuvQPoOkdLtxzjok+BRGoeLd4rGV6geuQ41LfPeS5XXQFLflM3szuppDMnzNR+1mF3jlQcx2Qwz5WvD7oXl533At/ZfR5OkodCXlaxZxb8zT0+3zpMLoKUC8mV5faHN4jRVyKNEJzNYRAyesIr2UzgQKnkwbIJ6OU7OvonlGEna4w1g+huwTw01+aYt5hUd/qCGWxmUTxRIP2sC9cZeIqNS+eq0Fenra6HhiuMt+v9e5vfucRQHu3AMZyF9eRUZCkbDdQ==212FD3x19z9sWBHDJACbC00B75E"



refresh_token = "ED8iwdLVwi286lhjRCOjnUMzmJ0Qvm8lWwErcGOX8fpx7bR5BpxhDdMj+RTu+wDJJNtKA/Lg3cZqZYq51EQXUJLVf+NRxcOAn4sdU2U4ZGz72wQwdt1VtdlV6j8ZLUr5YKRnuAAGSmzVPDKvgBoYkL3fKfmmzFPO6su6kd3/Vq+digng4ZOLkQVoQhKEm5q+VazGNxBUjs7bnRw8DDuG+tloJSkne7f2/bBXVvlWqF81u98K6Pi3KFO1rjPPfn+c3HOim6JpkCc/Qc/9xiFXK2Amp+ZexIBPpA+2PG809RcVz9yElZagXnM4Or/gNhzLaVdmo22qvAwoFoJm31WdFwWaDb4nrMlnMuteYteeZ/O7jbCtQrJCXBCW8wWizPoMqjc/l6sf8ysyEsogENfJfdN+CcqxPrQ7SfPHUo/tfgTfEYC7F+DA3kePRt6100MQuG4LYrgoVi/JHHvlW4vVnmtZx2Ce0vRq55W/3csC/oRcrq7dqw7t/91FLnTXWMBNRZvccuE0WjBiXg/KZQWcyZNvpqXb/gV/tJ5AsklXnCgIAjn++UH07tpjatMPX/5g0Vr3DGvea4UAM40xbnPfin+gSguv2y8yFbicwNH2OJLYoDJ3RzInGbIMbAdM7qSxvkFmNNR/Qe1N7vME/WEgXNkvBSi+cQcbFGq7Bn2370dskpDSgJZPj8OPavH9aqewmJfeVW8FWquOUTuoYzxnikiHEJeXhjy62ZX2YjaAbY6f6mzHF4nr/ooX0fCEads3t+YJhTsPG/jSGHBWROTiWlSWVp930jCivR+dnUMy4r2oOv+F71SYUA4RUPFvzRqUDtNXSEmJEIiuUSpjTIMRPdjvC54Ca5W/LxGKS+O0qPVl1kiZXVmmo52ozFYZENhqxN9CXCCDkHc=212FD3x19z9sWBHDJACbC00B75E",


#how to
# call back url https://localhost/mytest

#authoorization procedure
# first put this url into the browser, then sign in and allow access.
#https://auth.tdameritrade.com/auth?response_type=code&redirect_uri=https://localhost/mytest&client_id=Y1KS0BMRKRBSI6CVNYIHHN1NVF3VUI2J%40AMER.OAUTHAP

# ini the new url of the 404 page, copy the part after code=
#code = 0msbRVO7K8iQRwyuuAHGHUvDxWheo5CBe3MwfkBy7f8jQyokq61pqzoWgkIgZa0z2g4kgASwMyhIuWL25KGlnEDVJXdI6aNdpUBBFV%2FyYw32RP87QF5OP0Ub3DM0jGxtxnOdzOdzsf5A1hp8tbZD%2BNWl9Is6rWoU6NYbjVmPk3dVxQpMAUlqqmJCDtx9pvOs%2FZLynqzEXs0G4bavcmvVYttA4bmgTCVWRhQBrxYN8ff420jX50Q4audNHlq3KZhgM66XIrU6OSCEZwRnQLbEdUp9BeS6A0lpC6GMhHG6xhG02F57CoaPsT5x7jki3J406bN0VRsKlT16inH7NhPhjs%2F4td2o9fVdcmovqSGwXR2uTMwsR09k%2FOt%2FHKdlTUDpuvSg2KVnRu6LDaZiHvLHcB4wTNzWfKZ1yM%2BXROXeByVzzMDlWtqpt4iApaJ100MQuG4LYrgoVi%2FJHHvl9NiA9LBSAkkRzCIsr3tcR06zem4oCYH6dIoiV2%2FGfxsp978LoEe14aGMn1UoV4hADS%2F8Zfm8yn7XO%2B38y5%2FwDLpz%2BOjQjleghDR%2B1lhbfEclhklM6qmffcBVd4%2BcrJZupBZh7qdgZpTPjChrue8896xXmDMOWJf%2Ba%2FeZUXhahPjKcrORlQ7QI9O%2BpjsA5Xl1HyIBRO3eS3Hh%2BflnHJQ9kE8WgG0bbHr50Ee8c443nzfLtR8fXkF0SS%2BmP87vQRl8WExC4QK7poCf%2FfNENJCXXDytd9c7MgSzVZls8jI7Ztgp%2Biy02A85cMe%2Fg1pQNCBu05ZstVRbWMnZuloDCg5OhZ76GgQ999seohSamgWFbf9NodvZLLxFGvjj%2BSchTTVQAfWVRg47qM0q9SfYcgRLikfT9Qwp1duQeo7mnEiURMI66X0UwSsh4JX5zos%3D212FD3x19z9sWBHDJACbC00B75E

#for exmaple
# 4rWnpcXZGmKSvqqEKiabe6m3%2FMXdyLPwFlt6PZ3byvCkzNiOhMD6kOiEu6kVsyBqrnlv%2FMzCfmBRGTKANqmlG2QbPCwfvp88InUaN5zpJXke3ZlW9VhTUOpnxRNWh3NMed1AyEhHLCQ3U8yXuthBEO6lOV0K%2Fpoy6TiYJOgDM7Skpl4y6qF40ZAIpKmjMvC0nh%2Fdr98okAQw1OGagmyj2LYLeyMf3ioahq%2B%2BgLcqcwhOtZU%2B7s5HVjFvZzrC0GP3iOgqoyR2Wsyw6Vwwcb9zaB14ByvCuo116DwNnyIYVVwFwnFi8W4TofgeTt%2BU5%2FdSBhjyGLKOuQiB4FxSt7QYrl6hhrMeePHiX%2BPM0hDscKtZMxE11Y%2BkRei5ElxJHKBGo%2BmGeMUAgyjOHsRFvYo4mtpIRuALXYrnKkwwtU3U%2FNFZS5ZobKPitmqEpNJ100MQuG4LYrgoVi%2FJHHvlFBoaHvIqSPaxHUW%2FwJ7harT8xYEFo1VFa9nmAutUCTyDrvZIlIAlGfYY%2BmTGbPmQqubK%2F1WMPasHS0ZqHDbnqeeUP0cSoD95HmE9e4axQGXTGPaNT5dPrTEzONhWL5e58Me4OTqAxIVviqsCKSIDnBgpPMa1vdUo6VT%2BhA97My1gk%2Bu5Xk5NkqJ7QBaIGoEC3Co5w8Yu4dpEAf4lvpQItPQBJpiyvGmf5uJLx4ZkBeoTBwGCc0cx%2Bem6L0kKVhychDHxIsNidMC7w1siJaBp7SeyQmpD%2B4VkeJdjBQywvC7T1im7cfcdjWsJsJKpkb7ippyjnajgvXAlmTfgdIifCNUyk6bMQ6Oy6VoM94ikDFCJhzukyKvyLTBAnOrqsmnNXgFwKhgYL1%2FZ4tMca%2F19xr6vaUnIiSvV1Tp6U34yunMdnGC6V6e2Fjv%2F2ik%3D212FD3x19z9sWBHDJACbC00B75E


# then take that value and go to a URL decoder
# decode that url.

# decoded url
# 0msbRVO7K8iQRwyuuAHGHUvDxWheo5CBe3MwfkBy7f8jQyokq61pqzoWgkIgZa0z2g4kgASwMyhIuWL25KGlnEDVJXdI6aNdpUBBFV/yYw32RP87QF5OP0Ub3DM0jGxtxnOdzOdzsf5A1hp8tbZD+NWl9Is6rWoU6NYbjVmPk3dVxQpMAUlqqmJCDtx9pvOs/ZLynqzEXs0G4bavcmvVYttA4bmgTCVWRhQBrxYN8ff420jX50Q4audNHlq3KZhgM66XIrU6OSCEZwRnQLbEdUp9BeS6A0lpC6GMhHG6xhG02F57CoaPsT5x7jki3J406bN0VRsKlT16inH7NhPhjs/4td2o9fVdcmovqSGwXR2uTMwsR09k/Ot/HKdlTUDpuvSg2KVnRu6LDaZiHvLHcB4wTNzWfKZ1yM+XROXeByVzzMDlWtqpt4iApaJ100MQuG4LYrgoVi/JHHvl9NiA9LBSAkkRzCIsr3tcR06zem4oCYH6dIoiV2/Gfxsp978LoEe14aGMn1UoV4hADS/8Zfm8yn7XO+38y5/wDLpz+OjQjleghDR+1lhbfEclhklM6qmffcBVd4+crJZupBZh7qdgZpTPjChrue8896xXmDMOWJf+a/eZUXhahPjKcrORlQ7QI9O+pjsA5Xl1HyIBRO3eS3Hh+flnHJQ9kE8WgG0bbHr50Ee8c443nzfLtR8fXkF0SS+mP87vQRl8WExC4QK7poCf/fNENJCXXDytd9c7MgSzVZls8jI7Ztgp+iy02A85cMe/g1pQNCBu05ZstVRbWMnZuloDCg5OhZ76GgQ999seohSamgWFbf9NodvZLLxFGvjj+SchTTVQAfWVRg47qM0q9SfYcgRLikfT9Qwp1duQeo7mnEiURMI66X0UwSsh4JX5zos=212FD3x19z9sWBHDJACbC00B75E


# use the decoded url as the code to the code field of the authorization request
# grant type is authorize request
# must have offline and redirect uri and client id


# now you have permission to move money, place trades, and access account details

# make authenticated requests with this header "Bearer {ACCESS TOKEN}"


# structure

# have pre-made list of stocks ranigng in dollar value to the equivalent of 100 shares
# have some timing system that will work every monday an hour or so after open
# every monday it looks at the list of stocks, compares the dollar value to 100 shares
# Identify an overvalued call in the weekly options chain
# sells the option
# comes back on monday to see if the shares were sold. Does this by checking account balances
# if shares remain unsold, sells another option.
# if shares are sold, rebuys into some stock at 100 shares and repeats process,







#https://localhost/mytest?code=%2Bc2wgMPKkMPGnCiU0xn57QhUJv6u5uFeSVDlDZ7UyM9Of3bqpGgdN%2BvE9DCCFFvMJ%2FHr0Ujd%2FTQ0SnGyl0uc5shbGuGIqBwEHSrCt8f%2FY1mLsvA3j2n9CiYKk2fJy5rXCI6%2BGDrybU7wi8NczwzWarb5uP4hMYtb4fdvNQngf%2Fu2qgeRNSs3NNiVo1xekhEkCP43xjW2kZi5jXhVEjZtOhDHL5UDjgVZGns4aaTEMGCTf%2FdUO1Aw1GNqzm3XtJhoAxh0j8ByzJTlZ5QSUXGHj7UXIOjJxj3zPdtZyunA3TZz3CFn52XXKH9zIrPODP3YDOA8T7QpL6nYoZGv1x0WD5J8x6Xfvdl7AvyhSmIu1DPOyh4aW4Nools2efLUr6J8WZObs0NRB%2FdzsuXRSyWjZ4zW8vde5XeBfozy6G44wZDFXK%2FwkFAAlo2lO2b100MQuG4LYrgoVi%2FJHHvlT%2Ft8q59dUZQi%2BwLEdEfoe%2Bz66ju0YJMXAqBhnDIIw%2FxyslIvD%2B3HdagVXnRv3I78URQcrByKhOGxVfxL6XhT3BnUzY5NXUqtyAtcXqBd39riVOtn2vUjYbA9WLWdnoDaZffAXI90VCdwNwQdZne0LSavwvQkgwKy3faJTfvJNnPx0mg%2FlkfWuRwo7evspm%2F1XuKb08Z9OafExFywtRUxe7w%2F6qWJFhrboBzXwetHM5NVaoNhNr58iaE0goGZjnkmqTypHscW1MbkfDfnZZfkBs2cba0Ou1J1v4%2FRgI6zBUJLlEJtNILc%2B6J8iA3uUD3GGFAIlr7nDqc36aOmWBTlBE%2BWscoJkhFMEQziCQzT1QRJO9AHfyVMkJHL8gbYMZZE6Aqh9hKvag7HB4F9%2BcAo8pnasy%2BplXMvurO05oRv4Jp2nuO4%2FH821zlPKGQ%3D212FD3x19z9sWBHDJACbC00B75E


{
  "access_token": "y0fbcMLWPmZ/3JCQC6tLhiyvFqWusv5aMRnH6DsHLnGy0xTYx+djg2IxpmO8sJwF4soent/i1iVuIOVMsB5/dJGkKhacyGO1oGFMQ+lIKhRGB1M/6kqCFjc68hgiOLTS4/V2Gvq+Yr9z6Ze++5VymK8gzGzB7XuEbbJrh2AE6RxE8e1eO/BoY4lAIxVEAVQSpAQcx1HzC231OlwcTC7rxQI2cfiD1uPQWrPTIbfUP/b6d6TbBo0qk+7VrOj4CemZ87wLoLmszXIH/zFV0eYLR5MOlK43x22TQXkCjWWvUh/ON9o1IinO86yRDcaYryab6uyWFkSAKKekPstZDsT7Hw1TEUTBv55RDoE9YdfwFU2RBN7JNAQ4AMr54JPAyU0+ZHcJQ8h3caI4qhUk7mddyiOXpKzoL68axfCTx5mc2cvaz3QzhFrYWyo3sep872arL50rT9XcaTtnB/rZMx2TM52nEXc4XHoNJI6Df00rPcmHShul9HtsHAMj2zzef7jpKF4u11HGJEDUqjW8SO4KCxWw+zy3nGLURZFTy93bVXKkwHgaE100MQuG4LYrgoVi/JHHvl+pNCjt36YXoLK2sAS2xrp1LlwN4nGJ4PIe9Wb6B7Fvj4MNsFEQKIN3vNgMUHC9jMXmjJlye6H7zeYEG5liIYhPHxCnqVrqzTWlQzE96dNvR61fSrAjsQRKzaACuE/8ib6N1gKIR/37AkhSKghJzVpeLTZZKQ/Rhefjp7a6Ps17w7WCm8QDJlgtdwmAMasLM1n1mQVhb/k1V9jU2AjINMHktqUIPbq5QJlcwgwIhjbQIM+VMc8R87+4kuv/Zk4S/ZwOdVlLbgMUCsmXT6QNGx3Z1GsTG2jT0cqECziFQPnl0wuvQPoOkdLtxzjok+BRGoeLd4rGV6geuQ41LfPeS5XXQFLflM3szuppDMnzNR+1mF3jlQcx2Qwz5WvD7oXl533At/ZfR5OkodCXlaxZxb8zT0+3zpMLoKUC8mV5faHN4jRVyKNEJzNYRAyesIr2UzgQKnkwbIJ6OU7OvonlGEna4w1g+huwTw01+aYt5hUd/qCGWxmUTxRIP2sC9cZeIqNS+eq0Fenra6HhiuMt+v9e5vfucRQHu3AMZyF9eRUZCkbDdQ==212FD3x19z9sWBHDJACbC00B75E",

  "refresh_token": "ED8iwdLVwi286lhjRCOjnUMzmJ0Qvm8lWwErcGOX8fpx7bR5BpxhDdMj+RTu+wDJJNtKA/Lg3cZqZYq51EQXUJLVf+NRxcOAn4sdU2U4ZGz72wQwdt1VtdlV6j8ZLUr5YKRnuAAGSmzVPDKvgBoYkL3fKfmmzFPO6su6kd3/Vq+digng4ZOLkQVoQhKEm5q+VazGNxBUjs7bnRw8DDuG+tloJSkne7f2/bBXVvlWqF81u98K6Pi3KFO1rjPPfn+c3HOim6JpkCc/Qc/9xiFXK2Amp+ZexIBPpA+2PG809RcVz9yElZagXnM4Or/gNhzLaVdmo22qvAwoFoJm31WdFwWaDb4nrMlnMuteYteeZ/O7jbCtQrJCXBCW8wWizPoMqjc/l6sf8ysyEsogENfJfdN+CcqxPrQ7SfPHUo/tfgTfEYC7F+DA3kePRt6100MQuG4LYrgoVi/JHHvlW4vVnmtZx2Ce0vRq55W/3csC/oRcrq7dqw7t/91FLnTXWMBNRZvccuE0WjBiXg/KZQWcyZNvpqXb/gV/tJ5AsklXnCgIAjn++UH07tpjatMPX/5g0Vr3DGvea4UAM40xbnPfin+gSguv2y8yFbicwNH2OJLYoDJ3RzInGbIMbAdM7qSxvkFmNNR/Qe1N7vME/WEgXNkvBSi+cQcbFGq7Bn2370dskpDSgJZPj8OPavH9aqewmJfeVW8FWquOUTuoYzxnikiHEJeXhjy62ZX2YjaAbY6f6mzHF4nr/ooX0fCEads3t+YJhTsPG/jSGHBWROTiWlSWVp930jCivR+dnUMy4r2oOv+F71SYUA4RUPFvzRqUDtNXSEmJEIiuUSpjTIMRPdjvC54Ca5W/LxGKS+O0qPVl1kiZXVmmo52ozFYZENhqxN9CXCCDkHc=212FD3x19z9sWBHDJACbC00B75E",

  "scope": "PlaceTrades AccountAccess MoveMoney",
  "expires_in": 1800,
  "refresh_token_expires_in": 7776000,
  "token_type": "Bearer"
}